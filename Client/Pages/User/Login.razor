@page "/User/Login"
@using SmartProctor.Shared.Requests
@layout LoginLayout
@inject NavigationManager NavManager
@inject IUserServices UserServices
@inject ModalService Modal

<Form Model="@model"
      OnFinish="OnFinish">
    <Paragraph Class="text-center">User Login</Paragraph>
    <FormItem>
        <Input @bind-Value="@context.UserName" Placeholder="Username/Phone/Email"/>
    </FormItem>
    <FormItem>
        <InputPassword @bind-Value="@context.Password" Placeholder="Password"/>
    </FormItem>
    <FormItem>
        <Checkbox @bind-Value="context.Remember">Remember me</Checkbox>
    </FormItem>
    <FormItem WrapperColOffset="8" WrapperColSpan="16">
        <Button Type="@ButtonType.Primary" HtmlType="submit">
            Login
        </Button>
        <Button Type="link" OnClick="OnRegister">Register</Button>
    </FormItem>
</Form>

@code {
    private LoginRequestModel model = new LoginRequestModel();

    private void OnRegister()
    {
        // redirect to register
        NavManager.NavigateTo("/User/Register");
    }

    private async Task OnFinish(EditContext editContext)
    {
        var result = await UserServices.LoginAsync(model);

        if (result != ErrorCodes.Success)
        {
            Modal.Error(new ConfirmOptions()
            {
                Title = "Login failed",
                Content = ErrorCodes.MessageMap[result]
            });
        }
        else
        {
            // Login success
            NavManager.NavigateTo("/");
        }
    }

}